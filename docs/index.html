<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Compiler Documentation</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<button id="theme-toggle" class="theme-toggle">Dark Mode</button>
<div class="layout">
    <aside class="sidebar">
        <nav class="nav">
            <h2>Documentation</h2>
            <label for="version-select" class="version-label">Version:</label>
            <select id="version-select">
                <option value="v1.0">v1.0 (Stable)</option>
                <option value="v1.1" selected>v1.1 (Current - v1.1.12)</option>
            </select>
            <ul>
                <li><a href="#" data-md="index.md" class="nav-overview">Overview</a></li>
                
                <li class="category"><span>Getting Started</span>
                    <ul>
                        <li><a href="#" data-md="intro.md">Quick Start</a></li>
                        <li><a href="#" data-md="usage.md">Installation & Usage</a></li>
                    </ul>
                </li>
                
                <li class="category"><span>Compiler</span>
                    <ul>
                        <li><a href="#" data-md="compiler/index.md">Architecture</a></li>
                        <li><a href="#" data-md="compiler/intellisense.md">IDE Integration</a></li>
                        <li><a href="#" data-md="compiler/build.md">Build System</a></li>
                        <li><a href="#" data-md="compiler/testing.md">Testing Framework</a></li>
                    </ul>
                </li>
                
                <li class="category"><span>Language Reference</span>
                    <ul>
                        <li class="subcategory"><span>Type System</span>
                            <ul>
                                <li><a href="#" data-md="variables.md">Variables & Types</a></li>
                                <li><a href="#" data-md="arrays.md">Arrays</a></li>
                                <li><a href="#" data-md="strings.md">Strings</a></li>
                                <li><a href="#" data-md="classes.md">Classes & Structs</a></li>
                            </ul>
                        </li>
                        <li class="subcategory"><span>Operators</span>
                            <ul>
                                <li><a href="#" data-md="arithmetic.md">Arithmetic</a></li>
                                <li><a href="#" data-md="comparison.md">Comparison</a></li>
                                <li><a href="#" data-md="logical.md">Logical</a></li>
                                <li><a href="#" data-md="bitwise.md">Bitwise</a></li>
                                <li><a href="#" data-md="conditional.md">Conditional</a></li>
                            </ul>
                        </li>
                        <li class="subcategory"><span>Control Flow</span>
                            <ul>
                                <li><a href="#" data-md="if.md">If Statements</a></li>
                                <li><a href="#" data-md="loops.md">Loops</a></li>
                                <li><a href="#" data-md="switch.md">Switch Statements</a></li>
                                <li><a href="#" data-md="exceptions.md">Exception Handling</a></li>
                            </ul>
                        </li>
                        <li class="subcategory"><span>Functions</span>
                            <ul>
                                <li><a href="#" data-md="functions.md">Function Definitions</a></li>
                                <li><a href="#" data-md="return.md">Return Values</a></li>
                                <li><a href="#" data-md="parameters.md">Parameters</a></li>
                            </ul>
                        </li>
                        <li class="subcategory"><span>I/O & Console</span>
                            <ul>
                                <li><a href="#" data-md="console.md">Console Operations</a></li>
                                <li><a href="#" data-md="input-output.md">Input/Output</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                
                <li class="category"><span>Advanced Features</span>
                    <ul>
                        <li><a href="#" data-md="modules.md">Multi-file Compilation</a></li>
                        <li><a href="#" data-md="memory.md">Memory Management</a></li>
                        <li><a href="#" data-md="interop.md">C Interoperability</a></li>
                    </ul>
                </li>
                
                <li class="category"><span>Reference</span>
                    <ul>
                        <li><a href="#" data-md="grammar/Grammar.md">Grammar Specification</a></li>
                        <li><a href="#" data-md="keywords.md">Keywords & Operators</a></li>
                        <li><a href="#" data-md="runtime.md">Runtime Library</a></li>
                        <li><a href="#" data-md="changelog.md">Changelog</a></li>
                    </ul>
                </li>
                
                <li class="category"><span>Examples</span>
                    <ul>
                        <li><a href="#" data-md="examples/basic.md">Basic Programs</a></li>
                        <li><a href="#" data-md="examples/functions.md">Functions</a></li>
                        <li><a href="#" data-md="examples/classes.md">Object-Oriented</a></li>
                        <li><a href="#" data-md="examples/multifile.md">Multi-file Projects</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>
    <main class="main-content">
        <div id="content">
            <header>
                <h1>Dream Compiler Documentation</h1>
                <p>Welcome to the documentation for the Dream language and compiler. Use the sidebar to explore the available guides and features.</p>
            </header>
        </div>
    </main>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const contentDiv = document.getElementById('content');
        const navLinks = document.querySelectorAll('.nav a');
        const themeToggle = document.getElementById('theme-toggle');
        const themeLink = document.querySelector('link[rel="stylesheet"]');
        const categories = document.querySelectorAll('.category');
        const versionSelect = document.getElementById('version-select');

        // Apply saved theme
        if (localStorage.getItem('theme') === 'dark') {
            themeLink.setAttribute('href', 'index-dark.css');
            themeToggle.textContent = 'Light Mode';
        }

        // Apply saved version
        const savedVersion = localStorage.getItem('version') || 'v1.1';
        versionSelect.value = savedVersion;

        // Function to load and render markdown
        async function loadMarkdown(file) {
            try {
                const response = await fetch(file);
                if (!response.ok) throw new Error('Failed to load markdown file');
                const markdown = await response.text();
                contentDiv.innerHTML = marked.parse(markdown);
                
                // Add copy buttons to code blocks
                addCopyButtons();
            } catch (error) {
                contentDiv.innerHTML = '<h1>Error</h1><p>Could not load the documentation page: ' + file + '</p>';
            }
        }

        function addCopyButtons() {
            const codeBlocks = contentDiv.querySelectorAll('pre');
            codeBlocks.forEach(block => {
                if (!block.querySelector('.copy-btn')) {
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.textContent = 'Copy';
                    copyBtn.onclick = () => {
                        const code = block.querySelector('code').textContent;
                        navigator.clipboard.writeText(code).then(() => {
                            copyBtn.textContent = 'Copied!';
                            setTimeout(() => copyBtn.textContent = 'Copy', 2000);
                        });
                    };
                    block.appendChild(copyBtn);
                }
            });
        }

        function resolvePath(mdFile) {
            const version = versionSelect.value;
            
            // Files that should use version-specific paths
            const versionedFiles = [
                'variables.md', 'arrays.md', 'strings.md', 'classes.md',
                'arithmetic.md', 'comparison.md', 'logical.md', 'conditional.md',
                'if.md', 'loops.md', 'switch.md', 'return.md',
                'functions.md', 'console.md', 'comments.md',
                'changelog.md', 'architecture.md', 'parentheses.md'
            ];
            
            // Check if this file should use version-specific path
            const fileName = mdFile.split('/').pop();
            if (versionedFiles.includes(fileName)) {
                return `${version}/${mdFile}`;
            }
            
            // Files that are version-independent
            return mdFile;
        }

        // Handle nav link clicks
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const mdFile = link.getAttribute('data-md');
                loadMarkdown(resolvePath(mdFile));
                // Update active link
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
            });
        });

        // Handle category toggle
        categories.forEach(category => {
            const span = category.querySelector('span');
            span.addEventListener('click', () => {
                category.classList.toggle('open');
            });
        });

        // Handle version change
        versionSelect.addEventListener('change', () => {
            localStorage.setItem('version', versionSelect.value);
            // Reload current page with new version
            const activeLink = document.querySelector('.nav a.active');
            if (activeLink) {
                const mdFile = activeLink.getAttribute('data-md');
                loadMarkdown(resolvePath(mdFile));
            }
        });

        // Toggle light/dark mode
        themeToggle.addEventListener('click', () => {
            const current = themeLink.getAttribute('href');
            if (current === 'index.css') {
                themeLink.setAttribute('href', 'index-dark.css');
                themeToggle.textContent = 'Light Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                themeLink.setAttribute('href', 'index.css');
                themeToggle.textContent = 'Dark Mode';
                localStorage.setItem('theme', 'light');
            }
        });

        // Load default page
        const defaultLink = document.querySelector('.nav a[data-md="index.md"]');
        if (defaultLink) {
            defaultLink.classList.add('active');
            loadMarkdown(resolvePath('index.md'));
        }
    });
</script>
</body>
</html>
